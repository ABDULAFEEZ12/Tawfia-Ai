<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tawfiq AI - Smart Islamic Companion</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s, color 0.3s;
        }
        header {
            text-align: center;
            padding: 20px;
            width: 100%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        header h1 {
            margin: 0;
            font-size: 28px;
            letter-spacing: 1px;
        }
        header h3 {
            margin: 5px 0 0;
            font-weight: normal;
            font-size: 16px;
            opacity: 0.8;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            width: 100%;
            background: rgba(0,0,0,0.05);
            border-radius: 30px;
            overflow: hidden;
            max-width: 600px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s;
            font-size: 16px;
        }
        .tab:hover {
            background: rgba(0,0,0,0.1);
        }
        .tab.active {
            background: #009688;
            font-weight: bold;
            color: #fff;
        }
        .section {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 700px;
            padding: 20px;
            background: rgba(0,0,0,0.05);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow-y: auto;
            height: 65vh;
            animation: fadeIn 0.5s ease forwards;
        }
        .section.active {
            display: flex;
        }
        input[type="text"], select {
            width: 80%;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }
        button {
            padding: 12px 25px;
            border: none;
            background: #009688;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background 0.3s;
        }
        button:hover {
            background: #00796b;
        }
        .messages, .results {
            margin-top: 20px;
            width: 100%;
            max-height: calc(65vh - 150px); /* Adjust based on input/button height */
            overflow-y: auto;
            text-align: left;
        }
        .messages p,
        .results div { /* Basic styling for individual results */
            background: rgba(0, 0, 0, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            word-wrap: break-word;
        }
        .user-message {
            background: rgba(0, 150, 136, 0.2);
        }

        /* âœ… Styles for structured Quran results */
        .quran-verse {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            background: rgba(0, 150, 136, 0.05); /* Light green background */
        }
        .quran-verse p {
            margin: 5px 0; /* Adjust spacing between translation and arabic */
            padding: 0; /* Remove default paragraph padding */
             background: none; /* Remove background from inner paragraphs */
        }
         .quran-verse p:first-child {
             font-weight: bold;
             color: #00796b; /* Darker green for verse number */
         }
         .quran-verse p:last-child {
             font-size: 1.2em; /* Larger font for Arabic */
             direction: rtl; /* Right-to-left */
             text-align: right;
             font-weight: normal; /* Adjust font weight for Arabic */
         }

        /* âœ… Styles for structured Hadith results */
        .hadith-entry {
             border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            background: rgba(255, 193, 7, 0.05); /* Light amber background */
        }
         .hadith-entry p {
             margin: 5px 0;
             padding: 0;
             background: none;
         }
        .hadith-entry p:first-child {
            font-size: 0.9em; /* Smaller font for info */
            color: #ffa000; /* Darker amber for info */
        }
         .hadith-entry p:last-child {
             font-size: 1em; /* Normal font for Hadith text */
         }


        .toggle-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s;
        }
        .toggle-btn:hover {
            background-color: #45a049;
        }
        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(20px);}
            to {opacity: 1; transform: translateY(0);}
        }
        body.light-mode {
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2, #80deea);
            color: #000;
        }
        body.light-mode .tabs {
            background: rgba(255,255,255,0.7);
        }
        body.light-mode .section {
            background: rgba(255,255,255,0.9);
        }
        body.light-mode .messages p,
        body.light-mode .results div {
            background: rgba(0, 0, 0, 0.05);
        }
        body.light-mode .quran-verse {
             background: rgba(0, 150, 136, 0.05);
             border-color: #eee;
        }
        body.light-mode .hadith-entry {
            background: rgba(255, 193, 7, 0.05);
            border-color: #eee;
        }


        body.dark-mode {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
        }
        body.dark-mode .tabs {
            background: rgba(255,255,255,0.1);
        }
        body.dark-mode .section {
            background: rgba(0,0,0,0.3);
        }
        body.dark-mode .messages p,
        body.dark-mode .results div {
            background: rgba(255, 255, 255, 0.1);
        }
         body.dark-mode .quran-verse {
             background: rgba(0, 150, 136, 0.15); /* Slightly darker green */
             border-color: #333;
        }
        body.dark-mode .hadith-entry {
            background: rgba(255, 193, 7, 0.15); /* Slightly darker amber */
             border-color: #333;
        }
        body.dark-mode .quran-verse p:first-child {
             color: #4db6ac; /* Lighter green */
        }
         body.dark-mode .hadith-entry p:first-child {
            color: #ffb300; /* Lighter amber */
        }


    </style>
</head>
<body class="light-mode">

<button class="toggle-btn" onclick="toggleMode()">Toggle Light/Dark Mode</button>

<header>
    <h1>ðŸŒ™ Tawfiq AI - Smart Islamic Companion ðŸŒ™</h1>
    <h3>âœ¨ Ask me anything about Islam âœ¨</h3>
</header>

<div class="tabs">
    <div class="tab active" onclick="switchTab('aiSection', event)">ðŸ¤– AI</div>
    <div class="tab" onclick="switchTab('quranSection', event)">ðŸ“– Quran</div>
    <div class="tab" onclick="switchTab('hadithSection', event)">ðŸ“œ Hadith</div>
</div>

<!-- AI Section -->
<div class="section active" id="aiSection">
    <input type="text" id="userInput" placeholder="Type your question here...">
    <button onclick="sendQuestion()">Ask</button>
    <div class="messages" id="messages"></div>
</div>

<!-- Quran Section -->
<div class="section" id="quranSection">
    <input type="text" id="quranInput" placeholder="Enter Surah name or keyword...">
    <select id="surahList">
        <option value="">-- Select Surah --</option>
    </select>
    <button onclick="searchQuran()">Search Surah</button>
    <div class="results" id="quranResult"></div>
</div>

<!-- Hadith Section -->
<div class="section" id="hadithSection">
    <input type="text" id="hadithInput" placeholder="Enter Hadith keyword or number...">
     <!-- You can populate this dropdown dynamically from backend if needed,
          but for now, a hardcoded list is used in loadHadithTopics() -->
    <select id="hadithDropdown">
        <option value="">-- Select Hadith Topic --</option>
    </select>
    <button onclick="searchHadith()">Search Hadith</button>
    <div class="results" id="hadithResult"></div>
</div>

<script>
function switchTab(sectionId, event) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    event.target.classList.add('active');
    // Clear results/messages when switching tabs (optional but good UX)
     document.getElementById('messages').innerHTML = '';
     document.getElementById('quranResult').innerHTML = '';
     document.getElementById('hadithResult').innerHTML = '';
}

function toggleMode() {
    document.body.classList.toggle('light-mode');
    document.body.classList.toggle('dark-mode');
}

function sendQuestion() {
    const input = document.getElementById("userInput").value.trim();
    if (!input) return;
    const messagesDiv = document.getElementById("messages");
    const userMsg = document.createElement("p");
    userMsg.classList.add("user-message");
    userMsg.textContent = "You: " + input;
    messagesDiv.appendChild(userMsg);
    document.getElementById("userInput").value = "";
    // This fetch call will only work if you have a backend server running at '/ask'
    // that handles the AI logic and returns a JSON response with an 'answer' field.
    fetch('/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question: input })
    }).then(res => res.json()).then(data => {
        const aiMsg = document.createElement("p");
        aiMsg.textContent = "Tawfiq AI: " + (data.answer || "Sorry, couldn't answer.");
        messagesDiv.appendChild(aiMsg);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }).catch(error => {
        console.error('Error fetching AI response:', error);
        const errorMsg = document.createElement("p");
        errorMsg.textContent = "Tawfiq AI: Error getting response.";
        messagesDiv.appendChild(errorMsg);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
}

// âœ… MODIFIED searchQuran FUNCTION
function searchQuran() {
    const query = document.getElementById("quranInput").value.trim() || document.getElementById("surahList").value;
    if (!query) return;
    const resultDiv = document.getElementById("quranResult");
    // Clear previous results, but keep the searching message
    resultDiv.innerHTML = `<div class="user-message">Searching: ${query}</div>`;

    fetch('/quran-search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query })
    }).then(res => res.json()).then(data => {
        // Clear previous results after getting data
         resultDiv.innerHTML = `<div class="user-message">Searching: ${query}</div>`; // Keep the searching message initially

        if (data.surah_title && data.results && Array.isArray(data.results) && data.results.length > 0) {
            // Add Surah Title
             const titleElement = document.createElement("div");
             titleElement.innerHTML = `<strong>${data.surah_title}:</strong>`;
             titleElement.style.fontWeight = 'bold';
             titleElement.style.marginBottom = '10px';
             resultDiv.appendChild(titleElement);


            data.results.forEach(verse => {
                const verseElement = document.createElement("div");
                verseElement.classList.add("quran-verse"); // Add a class for styling

                const verseInfo = document.createElement("p");
                verseInfo.innerHTML = `<strong>${verse.surah_number}:${verse.verse_number}</strong>`; // Display Surah and Verse number
                verseElement.appendChild(verseInfo);

                const translation = document.createElement("p");
                translation.textContent = verse.translation; // Display translation
                verseElement.appendChild(translation);

                const arabic = document.createElement("p");
                arabic.textContent = verse.arabic_text; // Display Arabic text
                arabic.style.textAlign = 'right'; // Arabic is right-to-left
                arabic.style.fontWeight = 'bold';
                arabic.style.marginTop = '5px';
                arabic.style.direction = 'rtl'; // Explicitly set direction for Arabic
                verseElement.appendChild(arabic);

                resultDiv.appendChild(verseElement);
            });
        } else if (data.result) { // Handle cases where no results are found but a message is returned
             resultDiv.innerHTML += `<div>${data.result}</div>`;
        }
        else {
            resultDiv.innerHTML += `<div>No result found for "${query}".</div>`;
        }
    }).catch(error => {
        console.error('Error fetching Quran search result:', error);
        resultDiv.innerHTML += `<div>Error searching Quran.</div>`;
    });
}

// âœ… MODIFIED searchHadith FUNCTION
function searchHadith() {
    const inputQuery = document.getElementById("hadithInput").value.trim();
    const dropdownQuery = document.getElementById("hadithDropdown").value;
    const query = inputQuery || dropdownQuery;
    if (!query) return;
    const resultDiv = document.getElementById("hadithResult");
    // Clear previous results, but keep the searching message
    resultDiv.innerHTML = `<div class="user-message">Searching: ${query}</div>`;

    fetch('/hadith-search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query })
    }).then(res => res.json()).then(data => {
        // Clear previous results after getting data
         resultDiv.innerHTML = `<div class="user-message">Searching: ${query}</div>`; // Keep the searching message initially

        if (data.results && Array.isArray(data.results) && data.results.length > 0) {
            data.results.forEach(hadith => {
                const hadithElement = document.createElement("div");
                hadithElement.classList.add("hadith-entry"); // Add a class for styling

                const hadithInfo = document.createElement("p");
                let infoText = '';
                // Construct the info string based on available data
                if (hadith.book_name && hadith.book_number && hadith.book_name !== 'Unknown Book' && hadith.book_number !== 'N/A') infoText += `<strong>Book:</strong> ${hadith.book_name} (${hadith.book_number})`;
                 else if (hadith.book_name && hadith.book_name !== 'Unknown Book') infoText += `<strong>Book:</strong> ${hadith.book_name}`;
                 else if (hadith.book_number && hadith.book_number !== 'N/A') infoText += `<strong>Book Number:</strong> ${hadith.book_number}`;

                if (hadith.volume_number && hadith.volume_number !== 'N/A') infoText += (infoText ? '<br>' : '') + `<strong>Volume:</strong> ${hadith.volume_number}`;

                 // Only add hadith_info if it's distinct and useful
                if (hadith.hadith_info && hadith.hadith_info !== 'Volume N/A, Book N/A' && !infoText.includes(hadith.hadith_info)) {
                     infoText += (infoText ? '<br>' : '') + `<strong>Info:</strong> ${hadith.hadith_info}`;
                }

                if (hadith.narrator && hadith.narrator !== 'Unknown narrator') infoText += (infoText ? '<br>' : '') + `<strong>Narrated by:</strong> ${hadith.narrator}`;


                hadithInfo.innerHTML = infoText;
                hadithElement.appendChild(hadithInfo);

                const hadithText = document.createElement("p");
                hadithText.textContent = hadith.text; // Display Hadith text
                hadithText.style.marginTop = '8px';
                hadithElement.appendChild(hadithText);

                resultDiv.appendChild(hadithElement);
            });
        } else if (data.result) { // Handle cases where no results are found but a message is returned
             resultDiv.innerHTML += `<div>${data.result}</div>`;
        }
         else {
            resultDiv.innerHTML += `<div>No result found for "${query}".</div>`;
        }
    }).catch(error => {
        console.error('Error fetching Hadith search result:', error);
        resultDiv.innerHTML += `<div>Error searching Hadith.</div>`;
    });
}


// Function to load Surah list from backend
function loadSurahList() {
    fetch('/get-surah-list')
        .then(res => res.json())
        .then(data => {
            const select = document.getElementById("surahList");
            // Clear existing options except the default one
            select.innerHTML = '<option value="">-- Select Surah --</option>';
            if (data.surahs && Array.isArray(data.surahs)) {
                data.surahs.forEach(surah => {
                    const option = document.createElement("option");
                    option.value = surah;
                    option.textContent = surah;
                    select.appendChild(option);
                });
            } else {
                 console.warn("Could not load Surah list from backend.");
                 // Fallback to hardcoded list if backend fails
                 loadHardcodedSurahList();
            }
        })
        .catch(error => {
            console.error('Error loading Surah list:', error);
             // Fallback to hardcoded list on error
            loadHardcodedSurahList();
        });
}

// Fallback function for hardcoded Surah list
function loadHardcodedSurahList() {
     const surahs = [
        "Al-Fatihah", "Al-Baqarah", "Aali Imran", "An-Nisa", "Al-Maidah", "Al-An'am", "Al-A'raf", "Al-Anfal",
        "At-Tawbah", "Yunus", "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra",
        "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan",
        "Ash-Shu'ara", "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum", "Luqman", "As-Sajdah", "Al-Ahzab",
        "Saba", "Fatir", "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura",
        "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf",
        "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'ah", "Al-Hadid", "Al-Mujadila",
        "Al-Hashr", "Al-Mumtahanah", "As-Saff", "Al-Jumu'ah", "Al-Munafiqun", "At-Taghabun", "At-Talaq",
        "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn", "Al-Muzzammil",
        "Al-Muddathir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba", "An-Nazi'at", "Abasa",
        "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq", "Al-Buruj", "At-Tariq", "Al-A'la",
        "Al-Ghashiyah", "Al-Fajr", "Al-Balad", "Ash-Shams", "Al-Layl", "Ad-Duhaa", "Ash-Sharh", "At-Tin",
        "Al-Alaq", "Al-Qadr", "Al-Bayyinah", "Az-Zalzalah", "Al-Adiyat", "Al-Qari'ah", "At-Takathur",
        "Al-Asr", "Al-Humazah", "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", "Al-Kafirun", "An-Nasr",
        "Al-Masad", "Al-Ikhlas", "Al-Falaq", "An-Nas"
    ];
    const select = document.getElementById("surahList");
     select.innerHTML = '<option value="">-- Select Surah --</option>'; // Clear before adding hardcoded list
    surahs.forEach(surah => {
        const option = document.createElement("option");
        option.value = surah;
        option.textContent = surah;
        select.appendChild(option);
    });
     console.log("Loaded hardcoded Surah list.");
}


// Load Hadith topics (using the existing hardcoded list)
function loadHadithTopics() {
    const topics = [
        "Hadith on Prayer", "Hadith on Faith", "Hadith on Charity", "Hadith on Patience", "Hadith on Gratitude",
        "Hadith on Kindness", "Hadith on Fasting", "Hadith on Hajj", "Hadith on Honesty", "Hadith on Forgiveness",
        "Hadith on Parents", "Hadith on Children", "Hadith on Marriage", "Hadith on Neighbors", "Hadith on Brotherhood",
        "Hadith on Modesty", "Hadith on Repentance", "Hadith on Mercy", "Hadith on Humility", "Hadith on Envy",
        "Hadith on Justice", "Hadith on Knowledge", "Hadith on Dua", "Hadith on Quran", "Hadith on Sunnah",
        "Hadith on Hellfire", "Hadith on Paradise", "Hadith on Backbiting", "Hadith on Lying", "Hadith on Trust",
        "Hadith on Trade", "Hadith on Wealth", "Hadith on Poverty", "Hadith on Oppression", "Hadith on Manners",
        "Hadith on Sincerity", "Hadith on Innovation", "Hadith on Angels", "Hadith on Jinn", "Hadith on Death",
        "Hadith on Resurrection", "Hadith on Signs of Day of Judgment", "Hadith on Health", "Hadith on Cleanliness",
        "Hadith on Generosity", "Hadith on Bribery", "Hadith on Gossip", "Hadith on Leadership", "Hadith on Love",
        "Hadith on Peace", "Hadith on Prayer at Night", "Hadith on Ablution", "Hadith on Sadaqah", "Hadith on Zakat",
        "Hadith on Seeking Knowledge", "Hadith on Good Deeds", "Hadith on Evil Deeds", "Hadith on Hypocrisy",
        "Hadith on Arrogance", "Hadith on Tawheed", "Hadith on Shirk", "Hadith on Respecting Elders", "Hadith on Youth",
        "Hadith on Orphans", "Hadith on Widows", "Hadith on Modesty in Dressing", "Hadith on Halal and Haram",
        "Hadith on Gossip", "Hadith on Anger", "Hadith on Smiling", "Hadith on Good Speech", "Hadith on Contentment",
        "Hadith on Worldly Life", "Hadith on Akhirah", "Hadith on Thankfulness", "Hadith on Seeking Forgiveness",
        "Hadith on Trials", "Hadith on Signs of Hypocrites", "Hadith on Visiting Graves", "Hadith on Trust in Allah",
        "Hadith on Destiny", "Hadith on Martyrdom", "Hadith on Courage", "Hadith on Sin", "Hadith on Purification",
        "Hadith on Eid", "Hadith on Sacrifice", "Hadith on Brotherhood in Islam", "Hadith on Leadership in Islam",
        "Hadith on Reciting Quran", "Hadith on Betrayal", "Hadith on Contentment", "Hadith on Piety", "Hadith on Remembrance of Allah",
        "Hadith on Friday Prayer", "Hadith on Allahâ€™s Mercy", "Hadith on Night of Qadr", "Hadith on Family Ties"
    ];

    const dropdown = document.getElementById("hadithDropdown");
    topics.forEach(topic => {
        const option = document.createElement("option");
        option.value = topic;
        option.textContent = topic;
        dropdown.appendChild(option);
    });
}


// Initialize Hadith topics and Surah list on page load
document.addEventListener("DOMContentLoaded", () => {
    loadHadithTopics();
    loadSurahList(); // Load Surah list from backend or fallback
});
</script>

</body>
</html>
