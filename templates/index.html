<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tawfiq AI ‚Äì Smart Islamic AI for Muslims Worldwide</title>
<meta name="description" content="Tawfiq AI is the smartest Muslim AI that helps with Quran, Hadith, Islamic questions, games, and more ‚Äì built for Muslims, by Muslims.">
<meta name="keywords" content="Tawfiq AI, Islamic AI, Muslim AI, Quran AI, Hadith Chatbot, Muslim Chatbot, AI for Muslims, Halal AI, Islamic ChatGPT">

<!-- Mobile-First Viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#00695c">

<!-- Touch Icons -->
<link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">

<!-- Open Graph -->
<meta property="og:title" content="Tawfiq AI ‚Äì Islamic AI Chatbot & Quran Helper" />
<meta property="og:description" content="Ask Islamic questions, get Quran answers, and play Muslim games with the smartest Islamic AI ‚Äì Tawfiq AI." />
<meta property="og:image" content="https://www.tawfiqai.com/static/logo.png" />
<meta property="og:url" content="https://www.tawfiqai.com/" />
<meta property="og:type" content="website" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Tawfiq AI ‚Äì Built for Muslims" />
<meta name="twitter:description" content="The world's friendliest halal AI. Quran, Hadith, and fun, all in one place." />
<meta name="twitter:image" content="https://www.tawfiqai.com/static/logo.png" />

<!-- Force update -->
<meta name="version" content="2.0.0">

<!-- External CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='live_meeting.css') }}">

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Enhanced CSS with Mobile-First Responsive Design -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

:root {
  --primary-color: #00695c;
  --secondary-color: #4CAF50;
  --accent-gold: #FFD700;
  --accent-blue: #2196F3;
  --light-bg: #f8f9fa;
  --dark-bg: #121212;
  --text-light: #333;
  --text-dark: #e0e0e0;
  --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
  --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.12);
  --shadow-strong: 0 12px 40px rgba(0, 0, 0, 0.15);
  --transition-smooth: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
}

/* ===== BASE MOBILE STYLES ===== */
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
  height: -webkit-fill-available;
}

body {
  font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  margin: 0;
  padding: 0;
  background-color: var(--light-bg);
  color: var(--text-light);
  line-height: 1.6;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  overflow-x: hidden;
  padding-top: var(--safe-area-top);
  padding-bottom: var(--safe-area-bottom);
  position: relative;
  transition: background-color 0.5s ease, color 0.5s ease;
}

body.light-mode {
  background-color: var(--light-bg);
  color: var(--text-light);
}

body.dark-mode {
  background-color: var(--dark-bg);
  color: var(--text-dark);
}

/* Prevent text size adjustment on orientation change */
html {
  -webkit-text-size-adjust: 100%;
}

/* ===== WELCOME EXPERIENCE ===== */
.welcome-overlay{
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at center, rgba(212,175,55,.12), transparent 60%),
    linear-gradient(135deg,#08131f,#0f2436,#08131f);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  overflow: hidden;
  transition: opacity 1.2s ease;
  padding: 20px;
}

/* ===== BACKGROUND ===== */
.depth-canvas {
  position: absolute;
  inset: 0;
  overflow: hidden;
}

.light-rays{
  position:absolute;
  inset:-60%;
  background:conic-gradient(
    transparent 0deg,
    rgba(212,175,55,.04) 45deg,
    transparent 90deg
  );
  animation:rotate 80s linear infinite;
}

@keyframes rotate{
  to{transform:rotate(360deg)}
}

.distant-stars {
  position: absolute;
  inset: 0;
}

.star{
  position:absolute;
  width:2px;height:2px;
  background:#fff;
  opacity:.15;
  border-radius:50%;
  animation:twinkle 8s infinite;
}

.distant-stars .star:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
.distant-stars .star:nth-child(2) { top: 60%; left: 85%; animation-delay: 1s; }
.distant-stars .star:nth-child(3) { top: 80%; left: 15%; animation-delay: 2s; }
.distant-stars .star:nth-child(4) { top: 30%; left: 70%; animation-delay: 3s; }
.distant-stars .star:nth-child(5) { top: 50%; left: 40%; animation-delay: 4s; }

@keyframes twinkle{
  50%{opacity:.6}
}

/* ===== CENTER ===== */
.welcome-center{
  text-align:center;
  z-index:2;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:2.2rem;
}

/* ===== T ===== */
.elegant-t-container{
  width:120px;
  height:120px;
}

.elegant-t svg{
  width:100%;
  height:100%;
  filter:drop-shadow(0 6px 14px rgba(0,0,0,.35));
}

@keyframes breathe{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-5px)}
}

.t-breathe{
  animation:breathe 7s ease-in-out infinite;
}

/* ===== TEXT ===== */
.tawfiq-text h1{
  font-size:2rem;
  font-weight:300;
  color:#fff;
  margin:0;
  font-family: 'Poppins', sans-serif;
  text-align: center;
}

.tawfiq-text p{
  font-size:.85rem;
  letter-spacing:1px;
  opacity:.7;
  margin-top:.4rem;
  font-family: 'Poppins', sans-serif;
  color: rgba(255,255,255,0.8);
  text-align: center;
}

/* ===== TYPING BLESSING ===== */
.blessings-area{
  max-width:100%;
  padding:0 20px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:4px;
}

.blessing{
  font-family:'Amiri',serif;
  font-size:1.2rem;
  line-height:1.6;
  color:rgba(255,255,255,.92);
  white-space:normal;
  word-break:break-word;
  text-align:center;
  min-height:60px;
  display:flex;
  align-items:center;
}

/* Cursor */
.cursor{
  font-size:1.4rem;
  color:rgba(255,255,255,.6);
  animation:blink 1s infinite;
}

@keyframes blink{
  50%{opacity:0}
}

/* ===== EXIT ===== */
.welcome-overlay.exit{
  opacity:0;
  pointer-events:none;
}

/* ===== TOP BAR STYLES ===== */
.top-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: linear-gradient(135deg, var(--primary-color), var(--accent-blue));
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 15px;
  z-index: 1000;
  gap: 12px;
  box-shadow: var(--shadow-soft);
}

.top-bar h2 {
  color: white;
  font-size: 1.2rem;
  margin: 0 auto;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Menu toggle button - mobile optimized */
#menu-toggle {
  font-size: 24px;
  cursor: pointer;
  background: rgba(255, 255, 255, 0.2);
  padding: 8px 12px;
  border-radius: 50%;
  border: none;
  color: white;
  min-width: 44px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-smooth);
  z-index: 1001;
}

#menu-toggle:active {
  transform: scale(0.95);
}

/* Theme toggle button - mobile optimized */
#theme-toggle {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  border-radius: 50%;
  color: white;
  padding: 8px 12px;
  font-size: 20px;
  cursor: pointer;
  min-width: 44px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-smooth);
  z-index: 1001;
}

#theme-toggle:active {
  transform: scale(0.95);
}

body.dark-mode #theme-toggle {
  background: rgba(255, 255, 255, 0.1);
}

/* ===== MENU OVERLAY ===== */
.menu-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease;
  -webkit-tap-highlight-color: transparent;
}

.menu-overlay.active {
  opacity: 1;
  visibility: visible;
}

/* ===== SIDE MENU STYLES ===== */
#side-menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 280px;
  height: 100%;
  background: linear-gradient(180deg, #121212 0%, #1a1a2e 100%);
  color: #fff;
  padding-top: 80px;
  transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  z-index: 1000;
  overflow-y: auto;
  border-top-right-radius: 20px;
  border-bottom-right-radius: 20px;
  box-shadow: 10px 0 30px rgba(0, 0, 0, 0.3);
  -webkit-overflow-scrolling: touch;
  transform: translateX(-280px);
}

#side-menu.open {
  transform: translateX(0);
}

#side-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

#side-menu li {
  padding: 16px 25px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  cursor: pointer;
  font-size: 1.05em;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  min-height: 50px;
  display: flex;
  align-items: center;
}

#side-menu li:before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.5s;
}

#side-menu li:hover:before {
  left: 100%;
}

#side-menu li:hover {
  background-color: rgba(255, 255, 255, 0.1);
  transform: translateX(10px);
  border-left: 4px solid var(--accent-gold);
}

#side-menu li:active {
  transform: translateX(5px) scale(0.98);
}

#side-menu a {
  color: inherit;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  padding: 4px 0;
}

#side-menu i {
  font-size: 1.2em;
  width: 24px;
  text-align: center;
}

/* Menu item specific colors */
#side-menu li:nth-child(1) i { color: #4CAF50; } /* Profile */
#side-menu li:nth-child(2) i { color: #2196F3; } /* Talk to Tawfiq */
#side-menu li:nth-child(3) i { color: #9C27B0; } /* Live Meeting */
#side-menu li:nth-child(4) i { color: #FF9800; } /* Prayer Times */
#side-menu li:nth-child(5) i { color: #00BCD4; } /* Dua */
#side-menu li:nth-child(6) i { color: #FF5722; } /* Daily Reminder */
#side-menu li:nth-child(7) i { color: #E91E63; } /* Islamic Motivation */
#side-menu li:nth-child(8) i { color: #3F51B5; } /* Visual Quran */
#side-menu li:nth-child(9) i { color: #009688; } /* Story Time */
#side-menu li:nth-child(10) i { color: #FFC107; } /* Reels */
#side-menu li:nth-child(11) i { color: #8BC34A; } /* Play Game */
#side-menu li:nth-child(12) i { color: #607D8B; } /* Settings */
#side-menu li:nth-child(13) i { color: #795548; } /* Privacy & Policy */
#side-menu li:nth-child(14) i { color: #9E9E9E; } /* About Tawfiq AI */
#side-menu li:nth-child(15) i { color: #FF5252; } /* Feedback / Report */

/* Scrollbar for menu */
#side-menu::-webkit-scrollbar {
  width: 6px;
}
#side-menu::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.3);
  border-radius: 3px;
}
#side-menu::-webkit-scrollbar-thumb:hover {
  background-color: rgba(255, 255, 255, 0.5);
}

/* Header adjustments */
header {
  text-align: center;
  padding: 70px 15px 20px;
  position: relative;
  overflow: hidden;
  margin-top: 60px;
}

h1 {
  font-size: 1.8rem;
  margin: 10px 0;
  background: linear-gradient(45deg, var(--primary-color), var(--accent-blue));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gentle-pulse 4s infinite;
  line-height: 1.3;
  padding: 0 10px;
}

@keyframes gentle-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

/* ===== SMILE BOOSTER - MOBILE OPTIMIZED ===== */
.smile-booster-container {
  position: fixed;
  bottom: 80px;
  right: 20px;
  z-index: 100;
}

.smile-button {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
  border: none;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 28px;
  box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
  transition: var(--transition-bounce);
  position: relative;
  z-index: 101;
  touch-action: manipulation;
  min-width: 60px;
  min-height: 60px;
}

.smile-button:active {
  transform: scale(0.9);
}

.compliment-bubble {
  position: absolute;
  bottom: 70px;
  right: 0;
  background: white;
  padding: 12px 16px;
  border-radius: 18px;
  box-shadow: var(--shadow-soft);
  max-width: 200px;
  opacity: 0;
  transform: translateY(10px);
  transition: var(--transition-smooth);
  font-family: 'Poppins', sans-serif;
  font-weight: 500;
  color: #333;
  text-align: center;
  z-index: 100;
  font-size: 0.9rem;
}

.compliment-bubble.show {
  opacity: 1;
  transform: translateY(0);
}

.compliment-bubble:after {
  content: '';
  position: absolute;
  top: 100%;
  right: 20px;
  border-width: 8px;
  border-style: solid;
  border-color: white transparent transparent transparent;
}

/* Auto-messages - mobile optimized */
.auto-message {
  position: fixed;
  bottom: 150px;
  right: 20px;
  background: rgba(76, 175, 80, 0.95);
  color: white;
  padding: 10px 14px;
  border-radius: 12px;
  box-shadow: var(--shadow-soft);
  max-width: 200px;
  opacity: 0;
  transform: translateX(100px);
  transition: var(--transition-bounce);
  z-index: 99;
  font-size: 0.9rem;
  backdrop-filter: blur(10px);
}

.auto-message.show {
  opacity: 1;
  transform: translateX(0);
}

/* ===== DELIGHTFUL INTERACTIONS ===== */
.ripple-button {
  position: relative;
  overflow: hidden;
}

.ripple-button:after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255, 255, 255, 0.6);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%);
  transform-origin: 50% 50%;
}

.ripple-button:focus:not(:active)::after {
  animation: ripple 1s ease-out;
}

@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.5;
  }
  100% {
    transform: scale(20, 20);
    opacity: 0;
  }
}

/* Bounce animations */
@keyframes bounce {
  0%, 20%, 60%, 100% { transform: translateY(0); }
  40% { transform: translateY(-10px); }
  80% { transform: translateY(-5px); }
}

.bounce-on-click:active {
  animation: bounce 0.5s;
}

/* ===== LIVING INTERFACE ===== */
.cursor-follower {
  position: fixed;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: rgba(0, 105, 92, 0.2);
  pointer-events: none;
  z-index: 9998;
  mix-blend-mode: screen;
  transition: transform 0.1s ease;
}

/* ===== VISUAL FEEDBACK ===== */
.celebration-animation {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9997;
  opacity: 0;
}

.celebration-particle {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--accent-gold);
  animation: celebration 1.5s ease-out forwards;
}

@keyframes celebration {
  0% {
    transform: translateY(100vh) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(-100px) rotate(360deg);
    opacity: 0;
  }
}

/* ===== ENGAGING CONTENT DISPLAY ===== */
.typing-text {
  overflow: hidden;
  border-right: 2px solid var(--primary-color);
  white-space: pre-wrap;
  animation: typing-cursor 0.7s step-end infinite;
}

@keyframes typing-cursor {
  0%, 100% { border-color: transparent; }
  50% { border-color: var(--primary-color); }
}

.floating-dua {
  animation: float-dua 8s ease-in-out infinite;
  position: relative;
}

@keyframes float-dua {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  33% { transform: translateY(-10px) rotate(1deg); }
  66% { transform: translateY(5px) rotate(-1deg); }
}

.rotating-bracket {
  display: inline-block;
  animation: rotate-bracket 20s linear infinite;
}

@keyframes rotate-bracket {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===== MICRO-DELIGHTS ===== */
.sliding-message {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: var(--primary-color);
  color: white;
  padding: 12px 20px;
  border-radius: 10px;
  box-shadow: var(--shadow-soft);
  transform: translateX(-120%);
  transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  z-index: 100;
}

.sliding-message.show {
  transform: translateX(0);
}

/* ===== TABS STYLES ===== */
.tabs {
  margin-top: 60px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}
.tab {
  padding: 12px 24px;
  border-radius: 25px;
  background-color: white;
  box-shadow: var(--shadow-soft);
  cursor: pointer;
  font-weight: 600;
  font-size: 1em;
  transition: var(--transition-bounce);
  position: relative;
  overflow: hidden;
}
.tab:before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  transition: left 0.5s;
}
.tab:hover:before {
  left: 100%;
}
.tab.active, .tab:hover {
  background-color: var(--primary-color);
  color: white;
  transform: translateY(-5px);
  box-shadow: var(--shadow-medium);
}

/* Sections styling */
.section {
  display: none;
  padding: 25px;
  max-width: 800px;
  margin: 25px auto;
  background-color: white;
  border-radius: 20px;
  box-shadow: var(--shadow-soft);
  position: relative;
  overflow: hidden;
}
body.dark-mode .section {
  background-color: #2c2c2c;
}
.section:before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary-color), var(--accent-blue), var(--secondary-color));
}
.section.active {
  display: block;
  animation: section-appear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes section-appear {
  0% { opacity: 0; transform: translateY(20px); }
  100% { opacity: 1; transform: translateY(0); }
}

/* Input fields - mobile optimized */
input[type="text"], select {
  width: 100%;
  padding: 16px;
  margin-top: 12px;
  border-radius: 12px;
  border: 2px solid #e0e0e0;
  font-size: 1rem;
  font-family: 'Poppins', sans-serif;
  transition: var(--transition-smooth);
  -webkit-appearance: none;
  appearance: none;
  min-height: 52px;
}

input[type="text"]:focus, select:focus {
  border-color: var(--primary-color);
  outline: none;
  box-shadow: 0 0 0 3px rgba(0, 105, 92, 0.2);
}

body.dark-mode input[type="text"],
body.dark-mode select {
  background-color: #333;
  border-color: #555;
  color: var(--text-dark);
}

/* Buttons styling */
button:not(#menu-toggle):not(#theme-toggle):not(.smile-button) {
  margin-top: 15px;
  padding: 14px 24px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--primary-color), var(--accent-blue));
  color: #fff;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  box-shadow: var(--shadow-soft);
  transition: var(--transition-bounce);
  position: relative;
  overflow: hidden;
  min-height: 52px;
  touch-action: manipulation;
}
button:not(#menu-toggle):not(#theme-toggle):not(.smile-button):before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}
button:not(#menu-toggle):not(#theme-toggle):not(.smile-button):hover:before {
  left: 100%;
}
button:not(#menu-toggle):not(#theme-toggle):not(.smile-button):hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-medium);
}
button:not(#menu-toggle):not(#theme-toggle):not(.smile-button):active {
  transform: translateY(-2px);
}

/* Messages container - mobile optimized */
.messages {
  margin-top: 20px;
  background-color: white;
  padding: 20px;
  border-radius: 15px;
  box-shadow: var(--shadow-soft);
  max-height: 400px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  font-family: inherit;
  display: flex;
  flex-direction: column;
  gap: 12px;
  min-height: 200px;
}
body.dark-mode .messages {
  background-color: #333;
}

/* Message bubbles - mobile optimized */
.user-message {
  align-self: flex-end;
  background: linear-gradient(135deg, #dcf8c6, #c5e8b7);
  color: #000;
  padding: 12px 18px;
  border-radius: 20px 20px 5px 20px;
  max-width: 85%;
  word-wrap: break-word;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  transition: var(--transition-smooth);
  font-size: 0.95rem;
  line-height: 1.4;
}
body.dark-mode .user-message {
  background: linear-gradient(135deg, #2d5a27, #3a6b31);
  color: white;
}

/* AI message style */
.ai-message {
  align-self: flex-start;
  background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
  color: #000;
  padding: 12px 18px;
  border-radius: 20px 20px 20px 5px;
  max-width: 85%;
  word-wrap: break-word;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  transition: var(--transition-smooth);
  font-size: 0.95rem;
  line-height: 1.4;
}
body.dark-mode .ai-message {
  background: linear-gradient(135deg, #424242, #333);
  color: white;
}

.user-message:hover, .ai-message:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

/* Video styles */
video {
  width: 300px;
  height: 225px;
  margin: 8px;
  border-radius: 10px;
  background: black;
  object-fit: cover;
}

#remoteVideos {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
}

/* Daily Dua Section Specific */
#dailyDuaSection {
  background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
  border-radius: 20px;
  padding: 25px;
  margin-top: 20px;
  box-shadow: var(--shadow-soft);
  text-align: center;
  position: relative;
  overflow: hidden;
}
body.dark-mode #dailyDuaSection {
  background: linear-gradient(135deg, #263238, #37474f);
}
#dailyDuaContent {
  font-size: 1.3em;
  font-family: 'Amiri', serif;
  color: #00695c;
  line-height: 1.8;
}
body.dark-mode #dailyDuaContent {
  color: #80cbc4;
}

/* Quran brackets rotation */
.quran-bracket {
  font-size: 1.5em;
  color: var(--primary-color);
  display: inline-block;
  margin: 0 10px;
}

/* Audio player with shimmer */
.audio-player {
  margin-top: 20px;
  width: 100%;
  background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
  border-radius: 15px;
  padding: 20px;
  position: relative;
  overflow: hidden;
}
body.dark-mode .audio-player {
  background: linear-gradient(135deg, #333, #424242);
}
.audio-controls {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-top: 15px;
}
.play-button {
  background: linear-gradient(135deg, var(--secondary-color), #45a049);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 50px;
  cursor: pointer;
  font-weight: bold;
  transition: var(--transition-smooth);
}
.play-button:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
}
.audio-progress {
  flex-grow: 1;
  height: 8px;
  background-color: #ddd;
  border-radius: 10px;
  overflow: hidden;
}
.audio-progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--accent-blue));
  width: 0%;
  transition: width 0.1s linear;
  position: relative;
  overflow: hidden;
}
.audio-progress-bar:after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 50%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  100% { left: 100%; }
}

/* ===== BOTTOM NAVIGATION FOR MOBILE ===== */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  display: flex;
  justify-content: space-around;
  padding: 10px 0 var(--safe-area-bottom);
  box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
  z-index: 999;
}

.bottom-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 12px;
  border: none;
  background: none;
  color: #666;
  font-size: 0.8rem;
  cursor: pointer;
  transition: var(--transition-smooth);
  min-height: 60px;
  flex: 1;
}

.bottom-nav-item:active {
  color: var(--primary-color);
  transform: scale(0.95);
}

.bottom-nav-item i {
  font-size: 1.2rem;
  margin-bottom: 4px;
}

.bottom-nav-item.active {
  color: var(--primary-color);
}

body.dark-mode .bottom-nav {
  background: #2c2c2c;
}

body.dark-mode .bottom-nav-item {
  color: #aaa;
}

body.dark-mode .bottom-nav-item.active {
  color: var(--accent-gold);
}

/* Auth Status */
.auth-status {
  text-align: center;
  padding: 10px;
  background: rgba(0,0,0,0.05);
  margin: 10px;
  border-radius: 10px;
}

.auth-status a {
  color: var(--primary-color);
  text-decoration: none;
  font-weight: 600;
}

/* ===== DESKTOP MENU AND THEME TOGGLES ===== */
/* Desktop menu toggle button */
#menu-toggle-desktop {
  display: none;
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1001;
  background: #fff;
  padding: 12px 16px;
  border-radius: 12px;
  box-shadow: var(--shadow-soft);
  transition: var(--transition-bounce);
  font-size: 24px;
  cursor: pointer;
  color: #333;
  border: none;
  min-width: auto;
  min-height: auto;
}

#menu-toggle-desktop:hover {
  background: #eee;
  transform: scale(1.1) rotate(90deg);
}

/* Desktop theme toggle button */
#theme-toggle-desktop {
  display: none;
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1001;
  padding: 12px 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-size: 20px;
  background: linear-gradient(135deg, #FFD700, #FFA500);
  color: #333;
  box-shadow: var(--shadow-soft);
  transition: var(--transition-bounce);
  min-width: auto;
  min-height: auto;
}

#theme-toggle-desktop:hover {
  transform: scale(1.1) rotate(15deg);
}

body.dark-mode #menu-toggle-desktop {
  background: #333;
  color: white;
}

body.dark-mode #theme-toggle-desktop {
  background: linear-gradient(135deg, #333, #555);
  color: #fff;
}

/* ===== RESPONSIVE ADJUSTMENTS ===== */

/* Small phones */
@media (max-width: 768px) {
  .top-bar {
    display: flex;
  }
  
  #menu-toggle-desktop,
  #theme-toggle-desktop {
    display: none !important;
  }
  
  header {
    padding: 70px 15px 20px;
  }
  
  h1 {
    font-size: 1.8rem;
  }
  
  .tabs {
    margin-top: 60px;
    flex-wrap: nowrap;
    overflow-x: auto;
    justify-content: flex-start;
    padding: 15px 10px;
    gap: 8px;
  }
  
  .tab {
    padding: 12px 20px;
    font-size: 0.9rem;
    white-space: nowrap;
  }
  
  .section {
    padding: 20px;
    margin: 0 10px 20px;
  }
  
  .smile-button {
    width: 60px;
    height: 60px;
    font-size: 28px;
    bottom: 80px;
    right: 20px;
  }
  
  .smile-booster-container {
    bottom: 80px;
    right: 20px;
  }
  
  .auto-message {
    bottom: 150px;
    right: 20px;
    max-width: 200px;
  }
  
  #side-menu {
    width: 280px;
  }
  
  video {
    width: 100%;
    height: auto;
    max-height: 300px;
  }
  
  #remoteVideos {
    flex-direction: column;
  }
  
  .bottom-nav {
    display: flex;
  }
}

@media (max-width: 480px) {
  .tawfiq-text h1 {
    font-size: 1.7rem;
  }
  
  .blessing {
    font-size: 1.1rem;
  }
  
  .elegant-t-container {
    width: 100px;
    height: 100px;
  }
  
  h1 {
    font-size: 1.5rem;
  }
  
  .tabs {
    gap: 8px;
  }
  
  .tab {
    padding: 10px 16px;
    font-size: 0.85rem;
  }
  
  button:not(#menu-toggle):not(#theme-toggle):not(.smile-button) {
    padding: 12px 18px;
  }
  
  #dailyDuaContent {
    font-size: 1.1em;
  }
  
  #side-menu {
    width: 250px;
  }
  
  #side-menu li {
    padding: 14px 20px;
    font-size: 1em;
  }
  
  .smile-button {
    width: 50px;
    height: 50px;
    font-size: 24px;
  }
  
  .auto-message {
    max-width: 180px;
    right: 15px;
    bottom: 130px;
  }
}

/* Tablets and larger phones */
@media (min-width: 769px) {
  .top-bar {
    display: none;
  }
  
  #menu-toggle-desktop,
  #theme-toggle-desktop {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  header {
    padding: 30px 20px;
    margin-top: 0;
  }
  
  h1 {
    font-size: 2.5rem;
  }
  
  .tawfiq-text h1 {
    font-size: 2.6rem;
  }
  
  .blessing {
    font-size: 1.4rem;
  }
  
  .elegant-t-container {
    width: 140px;
    height: 140px;
  }
  
  .tabs {
    margin-top: 100px;
  }
  
  .bottom-nav {
    display: none;
  }
  
  #side-menu {
    transform: translateX(-280px);
  }
  
  #side-menu.open {
    transform: translateX(0);
  }
  
  .menu-overlay {
    display: none;
  }
}

/* Landscape orientation */
@media (max-height: 600px) and (orientation: landscape) {
  header {
    padding-top: 50px;
    padding-bottom: 10px;
  }
  
  .tabs {
    margin-top: 40px;
    padding: 10px;
  }
  
  .section {
    min-height: 150px;
  }
  
  .messages {
    max-height: 200px;
  }
  
  .bottom-nav {
    padding: 5px 0 var(--safe-area-bottom);
  }
  
  .bottom-nav-item {
    min-height: 50px;
    font-size: 0.7rem;
  }
  
  .bottom-nav-item i {
    font-size: 1rem;
  }
}

/* High-resolution displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .section {
    border: 0.5px solid rgba(0,0,0,0.1);
  }
  
  body.dark-mode .section {
    border-color: rgba(255,255,255,0.1);
  }
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Dark mode preference */
@media (prefers-color-scheme: dark) {
  body:not(.light-mode) {
    background-color: var(--dark-bg);
    color: var(--text-dark);
  }
}

/* Hide cursor follower on touch devices */
@media (hover: none) and (pointer: coarse) {
  .cursor-follower {
    display: none;
  }
}

/* Hover effects only for non-touch devices */
@media (hover: hover) and (pointer: fine) {
  .hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-medium);
  }
  
  .hover-rotate:hover {
    transform: rotate(5deg);
  }
  
  .hover-glow:hover {
    box-shadow: 0 0 15px rgba(0, 105, 92, 0.3);
  }
  
  .smile-button:hover {
    transform: scale(1.1) rotate(10deg);
    box-shadow: 0 12px 30px rgba(255, 215, 0, 0.6);
  }
}
</style>
</head>
<body class="light-mode">

<!-- ===== TOP BAR FOR MOBILE ===== -->
<div class="top-bar">
  <button id="menu-toggle" aria-label="Open menu">
    <i class="fas fa-bars"></i>
  </button>
  <h2>Tawfiq AI</h2>
  <button id="theme-toggle" aria-label="Toggle theme">
    <i class="fas fa-sun"></i>
  </button>
</div>

<!-- ===== MENU OVERLAY ===== -->
<div class="menu-overlay" id="menuOverlay"></div>

<!-- ===== WELCOME EXPERIENCE ===== -->
<div id="welcome-overlay" class="welcome-overlay">
  <!-- Background -->
  <div class="depth-canvas">
    <div class="light-rays"></div>

    <div class="distant-stars">
      <span class="star"></span><span class="star"></span><span class="star"></span>
      <span class="star"></span><span class="star"></span>
    </div>
  </div>

  <!-- Center -->
  <div class="welcome-center">
    <!-- Elegant T -->
    <div class="elegant-t-container">
      <div class="elegant-t t-breathe">
        <svg viewBox="0 0 100 100">
          <defs>
            <linearGradient id="tGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#e6c76e"/>
              <stop offset="100%" stop-color="#b68d40"/>
            </linearGradient>
          </defs>
          <rect x="28" y="22" width="44" height="10" rx="3" fill="url(#tGrad)"/>
          <rect x="46" y="32" width="8" height="46" rx="3" fill="url(#tGrad)"/>
        </svg>
      </div>
    </div>

    <!-- Text -->
    <div class="tawfiq-text">
      <h1>Tawfiq AI</h1>
      <p>Your Smart Islamic Companion</p>
    </div>

    <!-- Blessing -->
    <div class="blessings-area">
      <div id="blessing" class="blessing"></div>
      <span class="cursor">|</span>
    </div>
  </div>
</div>

<!-- ===== DESKTOP TOGGLES ===== -->
<button id="menu-toggle-desktop" aria-label="Open menu">
  <i class="fas fa-bars"></i>
</button>
<button id="theme-toggle-desktop" aria-label="Toggle theme">
  <i class="fas fa-sun"></i>
</button>

<!-- ===== CURSOR FOLLOWER (Desktop only) ===== -->
<div class="cursor-follower"></div>

<!-- ===== SMILE BOOSTER ===== -->
<div class="smile-booster-container">
  <button class="smile-button bounce-on-click ripple-button" id="smileBtn" aria-label="Get Islamic compliment">
    <i class="fas fa-smile"></i>
  </button>
  <div class="compliment-bubble" id="complimentBubble">
    May Allah fill your heart with peace and joy!
  </div>
</div>

<!-- ===== AUTO MESSAGES ===== -->
<div class="auto-message" id="autoMessage">
  <i class="fas fa-heart" style="margin-right: 8px;"></i>
  <span id="autoMessageText">Remember Allah in every moment</span>
</div>

<!-- ===== CELEBRATION ANIMATION CONTAINER ===== -->
<div class="celebration-animation" id="celebrationContainer"></div>

<!-- ===== SLIDING MESSAGE ===== -->
<div class="sliding-message" id="slidingMessage">
  <i class="fas fa-star" style="margin-right: 8px;"></i>
  <span>Welcome to Tawfiq AI!</span>
</div>

<!-- ===== SIDEBAR MENU ===== -->
<nav id="side-menu">
  <ul>
    <li><a href="/profile"><i class="fas fa-user"></i> üë§ Profile</a></li>
    <li><a href="/talk-to-tawfiq"><i class="fas fa-microphone"></i> üéôÔ∏è Talk to Tawfiq</a></li>
    <li><a href="/live-meeting"><i class="fas fa-video"></i> üéôÔ∏è Live Meeting</a></li>
    <li><a href="/prayer-times"><i class="fas fa-mosque"></i> üïå Prayer Times</a></li>
    <li><a href="/duas"><i class="fas fa-hands-praying"></i> üïå Dua</a></li>
    <li><a href="/reminder"><i class="fas fa-bell"></i> üìÖ Daily Reminder</a></li>
    <li><a href="/motivation"><i class="fas fa-sparkles"></i> ‚ú® Islamic Motivation</a></li>
    <li><a href="/visual-quran"><i class="fas fa-book-quran"></i> ‚ú® Visual Quran</a></li>
    <li><a href="/story-time"><i class="fas fa-book-open"></i> üìñ Story Time</a></li>
    <li><a href="/reels"><i class="fas fa-mobile-alt"></i> üì± Reels</a></li>
    <li><a href="/trivia"><i class="fas fa-gamepad"></i> üéÆ Play Game</a></li>
    <li><a href="/settings"><i class="fas fa-cog"></i> ‚öôÔ∏è Settings</a></li>
    <li><a href="/privacy"><i class="fas fa-lock"></i> üîí Privacy & Policy</a></li>
    <li><a href="/about"><i class="fas fa-info-circle"></i> ‚ÑπÔ∏è About Tawfiq AI</a></li>
    <li><a href="/feedback"><i class="fas fa-comment-dots"></i> üì¢ Feedback / Report</a></li>
  </ul>
</nav>

<!-- Auth Status -->
<div class="auth-status">
  {% if user %}
    <p>Welcome, {{ user.username }}! <a href="/logout">Logout</a></p>
  {% else %}
    <p><a href="/login">Login</a> | <a href="/signup">Sign Up</a></p>
  {% endif %}
</div>

<!-- Main Header -->
<header>
  <h1 class="logo-living">üåô Tawfiq AI - Smart Islamic Companion üåô</h1>
  <h3 class="shimmering-header">‚ú® Ask me anything about Islam ‚ú®</h3>
</header>

<!-- TABS -->
<div class="tabs">
  <div class="tab active hover-lift" onclick="switchTab('aiSection', event)">ü§ñ AI Chat</div>
  <div class="tab hover-lift" onclick="switchTab('quranSection', event)">üìñ Quran</div>
  <div class="tab hover-lift" onclick="switchTab('hadithSection', event)">üìú Hadith</div>
  <div class="tab hover-lift" onclick="switchTab('duaSection', event)">üïå Daily Dua</div>
</div>

<!-- AI Section -->
<div class="section active" id="aiSection">
  <div class="messages" id="messages"></div>
  <input type="text" id="userInput" placeholder="Ask a question about Islam..." 
         enterkeyhint="send" inputmode="text" autocomplete="off" />
  <button id="askButton" class="ripple-button hover-lift">Ask Tawfiq AI</button>
</div>

<!-- Quran Section -->
<div class="section" id="quranSection">
  <input type="text" id="quranInput" placeholder="Enter Surah name or keyword..." 
         inputmode="text" autocomplete="off" />
  <select id="surahList">
    <option value="">-- Or Select Surah --</option>
  </select>
  <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
    <button id="quranSearchButton" class="ripple-button hover-lift">Search Surah</button>
    <button id="playSurahButton" class="ripple-button hover-lift" style="background: linear-gradient(135deg, #4CAF50, #45a049);">üéµ Play Surah</button>
  </div>
  <div class="audio-player" id="audioPlayer" style="display: none;">
    <audio id="surahAudio" controls style="width: 100%;" preload="metadata"></audio>
    <div class="audio-controls">
      <button class="play-button bounce-on-click" id="playPauseBtn">Play</button>
      <div class="audio-progress">
        <div class="audio-progress-bar" id="progressBar"></div>
      </div>
      <div class="audio-time" id="timeDisplay">0:00 / 0:00</div>
    </div>
  </div>
  <div class="results" id="quranResult" style="margin-top: 20px;"></div>
</div>

<!-- Hadith Section -->
<div class="section" id="hadithSection">
  <input type="text" id="hadithInput" placeholder="Enter Hadith keyword or number..." 
         inputmode="text" autocomplete="off" />
  <select id="hadithDropdown">
    <option value="">-- Or Select Hadith Topic --</option>
  </select>
  <button id="hadithSearchButton" class="ripple-button hover-lift">Search Hadith</button>
  <div class="results" id="hadithResult" style="margin-top: 20px;"></div>
</div>

<!-- Dua Section (Main) -->
<div class="section" id="duaSection">
  <h3><span class="quran-bracket rotating-bracket">Ô¥æ</span> Today's Dua <span class="quran-bracket rotating-bracket">Ô¥ø</span></h3>
  <!-- The prominent Daily Dua box -->
  <div id="dailyDuaSection" class="floating-dua">
    <h2>üïå Daily Dua üìø</h2>
    <div id="dailyDuaContent">Loading the Dua of the Day...</div>
  </div>
</div>

<!-- Prayer Times Section -->
<div class="section" id="prayerTimes" style="display:none;">
  <h3>üïå Prayer Times</h3>
  <div id="prayerTimesContent" style="padding: 10px;">
    <p>Loading prayer times...</p>
  </div>
</div>

<!-- ===== BOTTOM NAVIGATION (Mobile only) ===== -->
<nav class="bottom-nav">
  <button class="bottom-nav-item active" onclick="switchTab('aiSection', event)">
    <i class="fas fa-robot"></i>
    <span>AI Chat</span>
  </button>
  <button class="bottom-nav-item" onclick="switchTab('quranSection', event)">
    <i class="fas fa-book-quran"></i>
    <span>Quran</span>
  </button>
  <button class="bottom-nav-item" onclick="switchTab('hadithSection', event)">
    <i class="fas fa-book"></i>
    <span>Hadith</span>
  </button>
  <button class="bottom-nav-item" onclick="switchTab('duaSection', event)">
    <i class="fas fa-mosque"></i>
    <span>Dua</span>
  </button>
</nav>

<!-- Hidden SEO text -->
<div style="display:none;">
  Tawfiq AI is the leading Islamic AI built for Muslims who want smart, halal answers about Quran, Hadith, Fiqh, and life. It's like ChatGPT for Muslims ‚Äì helping with Islamic learning, daily dua, games, and more. Built with love for the ummah.
</div>

<!-- WebRTC Dependencies -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>

<script>
// ===== MOBILE MENU FUNCTIONALITY =====
document.addEventListener('DOMContentLoaded', function() {
  // Menu elements
  const menuToggle = document.getElementById('menu-toggle');
  const menuToggleDesktop = document.getElementById('menu-toggle-desktop');
  const sideMenu = document.getElementById('side-menu');
  const menuOverlay = document.getElementById('menuOverlay');
  
  // Theme elements
  const themeToggle = document.getElementById('theme-toggle');
  const themeToggleDesktop = document.getElementById('theme-toggle-desktop');
  
  // Menu functions
  function toggleMenu() {
    sideMenu.classList.toggle('open');
    menuOverlay.classList.toggle('active');
    document.body.style.overflow = sideMenu.classList.contains('open') ? 'hidden' : '';
  }
  
  function closeMenu() {
    sideMenu.classList.remove('open');
    menuOverlay.classList.remove('active');
    document.body.style.overflow = '';
  }
  
  // Mobile menu toggle
  if (menuToggle) {
    menuToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      toggleMenu();
    });
  }
  
  // Desktop menu toggle
  if (menuToggleDesktop) {
    menuToggleDesktop.addEventListener('click', function(e) {
      e.stopPropagation();
      toggleMenu();
    });
  }
  
  // Close menu when clicking overlay
  if (menuOverlay) {
    menuOverlay.addEventListener('click', closeMenu);
  }
  
  // Close menu when clicking outside on mobile
  document.addEventListener('click', function(e) {
    if (sideMenu.classList.contains('open') && 
        !sideMenu.contains(e.target) && 
        !menuToggle.contains(e.target) && 
        !menuToggleDesktop.contains(e.target)) {
      closeMenu();
    }
  });
  
  // Close menu on escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && sideMenu.classList.contains('open')) {
      closeMenu();
    }
  });
  
  // Close menu when clicking menu items
  const menuItems = document.querySelectorAll('#side-menu a');
  menuItems.forEach(item => {
    item.addEventListener('click', function() {
      setTimeout(closeMenu, 300);
    });
  });
  
  // Theme toggle functionality
  function toggleMode() {
    const body = document.body;
    
    body.classList.toggle('light-mode');
    body.classList.toggle('dark-mode');

    if (body.classList.contains('dark-mode')) {
      localStorage.setItem('theme', 'dark');
      if (themeToggle) {
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
      }
      if (themeToggleDesktop) {
        themeToggleDesktop.innerHTML = '<i class="fas fa-moon"></i>';
        themeToggleDesktop.style.background = 'linear-gradient(135deg, #333, #555)';
      }
    } else {
      localStorage.setItem('theme', 'light');
      if (themeToggle) {
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
      if (themeToggleDesktop) {
        themeToggleDesktop.innerHTML = '<i class="fas fa-sun"></i>';
        themeToggleDesktop.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
      }
    }
  }
  
  // Load saved theme
  function loadTheme() {
    const savedTheme = localStorage.getItem('theme');
    
    if (savedTheme === 'dark') {
      document.body.classList.remove('light-mode');
      document.body.classList.add('dark-mode');
      if (themeToggle) {
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
      }
      if (themeToggleDesktop) {
        themeToggleDesktop.innerHTML = '<i class="fas fa-moon"></i>';
        themeToggleDesktop.style.background = 'linear-gradient(135deg, #333, #555)';
      }
    } else {
      document.body.classList.remove('dark-mode');
      document.body.classList.add('light-mode');
      if (themeToggle) {
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
      if (themeToggleDesktop) {
        themeToggleDesktop.innerHTML = '<i class="fas fa-sun"></i>';
        themeToggleDesktop.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
      }
    }
  }
  
  // Attach theme toggle events
  if (themeToggle) {
    themeToggle.addEventListener('click', toggleMode);
  }
  
  if (themeToggleDesktop) {
    themeToggleDesktop.addEventListener('click', toggleMode);
  }
  
  // Load initial theme
  loadTheme();
});

// ===== REST OF YOUR JAVASCRIPT FUNCTIONS =====
// Detecting touch device
const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

// Prevent zoom on double tap
let lastTouchEnd = 0;
document.addEventListener('touchend', function(event) {
  const now = (new Date()).getTime();
  if (now - lastTouchEnd <= 300) {
    event.preventDefault();
  }
  lastTouchEnd = now;
}, false);

// Initialize all functionality
document.addEventListener('DOMContentLoaded', function() {
  // Add touch feedback classes
  if (isTouchDevice) {
    document.body.classList.add('touch-device');
  }

  // Initialize welcome experience
  initializeNewWelcomeExperience();
  
  // Initialize cursor follower for desktop only
  if (!isTouchDevice) {
    initializeCursorFollower();
  }
  
  // Initialize smile booster
  initializeSmileBooster();
  
  // Initialize auto messages
  initializeAutoMessages();
  
  // Initialize sliding message
  showSlidingMessage();
  
  // Load content
  loadDailyDua();
  loadHadithTopics();
  loadSurahList();
  initializeAudioPlayer();
  
  // Apply hover effects to existing elements
  applyHoverEffects();
  
  // Add celebration on first interaction
  document.addEventListener('click', function firstInteraction() {
    triggerCelebration();
    document.removeEventListener('click', firstInteraction);
  });
  
  // Bottom nav synchronization
  const bottomNavItems = document.querySelectorAll('.bottom-nav-item');
  bottomNavItems.forEach(item => {
    item.addEventListener('click', function() {
      bottomNavItems.forEach(i => i.classList.remove('active'));
      this.classList.add('active');
    });
  });
  
  // Initialize event listeners with touch support
  document.getElementById('askButton').addEventListener(isTouchDevice ? 'touchstart' : 'click', sendQuestion);
  document.getElementById('quranSearchButton').addEventListener(isTouchDevice ? 'touchstart' : 'click', searchQuran);
  document.getElementById('playSurahButton').addEventListener(isTouchDevice ? 'touchstart' : 'click', playSurah);
  document.getElementById('hadithSearchButton').addEventListener(isTouchDevice ? 'touchstart' : 'click', searchHadith);
  document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
  
  // Enter key for AI chat
  document.getElementById('userInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendQuestion();
  });
  
  // Handle orientation change
  window.addEventListener('orientationchange', function() {
    setTimeout(() => {
      window.scrollTo(0, 0);
    }, 100);
  });
});

// ===== WELCOME EXPERIENCE =====
function initializeNewWelcomeExperience() {
  const text = "In the name of Allah, the Most Gracious, the Most Merciful";
  const blessingEl = document.getElementById("blessing");
  const overlay = document.getElementById("welcome-overlay");
  const cursor = document.querySelector(".cursor");

  let i = 0;

  function typeBlessing() {
    if (i < text.length) {
      blessingEl.textContent += text.charAt(i);
      i++;
      setTimeout(typeBlessing, 60);
    } else {
      cursor.style.display = "none";
      setTimeout(() => {
        overlay.classList.add("exit");
        setTimeout(() => {
          overlay.style.display = "none";
        }, 1200);
      }, 2000);
    }
  }
  setTimeout(typeBlessing, 800);
}

// ===== CURSOR FOLLOWER =====
function initializeCursorFollower() {
  const follower = document.querySelector('.cursor-follower');
  let mouseX = 0, mouseY = 0;
  let followerX = 0, followerY = 0;
  
  document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
  });
  
  function animate() {
    // Calculate distance between cursor and follower
    let distX = mouseX - followerX;
    let distY = mouseY - followerY;
    
    // Move follower toward cursor with easing
    followerX += distX * 0.1;
    followerY += distY * 0.1;
    
    // Apply position
    follower.style.transform = `translate(${followerX - 10}px, ${followerY - 10}px)`;
    
    // Change size based on speed
    const speed = Math.sqrt(distX * distX + distY * distY);
    const size = Math.min(20 + speed * 0.05, 40);
    follower.style.width = `${size}px`;
    follower.style.height = `${size}px`;
    
    requestAnimationFrame(animate);
  }
  
  animate();
}

// ===== SMILE BOOSTER =====
function initializeSmileBooster() {
  const smileBtn = document.getElementById('smileBtn');
  const complimentBubble = document.getElementById('complimentBubble');
  
  const compliments = [
    "Masha'Allah! Your smile is sadaqah!",
    "Allah loves those who are cheerful!",
    "A smile is charity - Prophet Muhammad (PBUH)",
    "Your positivity brightens the day!",
    "May Allah accept your good deeds!",
    "Keep smiling, it's sunnah!",
    "Your faith shines through your smile!",
    "Allah rewards every good intention!",
    "Patience and gratitude bring smiles!",
    "Your smile makes angels smile too!"
  ];
  
  smileBtn.addEventListener('click', function() {
    // Select random compliment
    const randomCompliment = compliments[Math.floor(Math.random() * compliments.length)];
    complimentBubble.textContent = randomCompliment;
    
    // Show bubble
    complimentBubble.classList.add('show');
    
    // Add bounce effect to button
    this.classList.add('bounce-on-click');
    setTimeout(() => {
      this.classList.remove('bounce-on-click');
    }, 500);
    
    // Hide bubble after 4 seconds
    setTimeout(() => {
      complimentBubble.classList.remove('show');
    }, 4000);
    
    // Trigger celebration
    triggerMiniCelebration();
  });
}

// ===== AUTO MESSAGES =====
function initializeAutoMessages() {
  const autoMessage = document.getElementById('autoMessage');
  const autoMessageText = document.getElementById('autoMessageText');
  
  const autoMessages = [
    "Remember Allah in every moment",
    "Patience is a pillar of faith",
    "Gratitude increases blessings",
    "Prayer is the key to Paradise",
    "Charity erases sins",
    "Kindness is a mark of faith",
    "Seek knowledge from cradle to grave",
    "Trust in Allah's timing",
    "Forgive others as you seek forgiveness",
    "The best among you are those with the best character"
  ];
  
  let messageIndex = 0;
  
  // Show first message after 30 seconds
  setTimeout(showAutoMessage, 30000);
  
  // Show new message every 45 seconds
  setInterval(showAutoMessage, 45000);
  
  function showAutoMessage() {
    autoMessageText.textContent = autoMessages[messageIndex];
    autoMessage.classList.add('show');
    
    messageIndex = (messageIndex + 1) % autoMessages.length;
    
    // Hide after 6 seconds
    setTimeout(() => {
      autoMessage.classList.remove('show');
    }, 6000);
  }
}

// ===== SLIDING MESSAGE =====
function showSlidingMessage() {
  const slidingMessage = document.getElementById('slidingMessage');
  
  // Show message after welcome overlay disappears
  setTimeout(() => {
    slidingMessage.classList.add('show');
    
    // Hide after 5 seconds
    setTimeout(() => {
      slidingMessage.classList.remove('show');
    }, 5000);
  }, 5000);
}

// ===== CELEBRATION ANIMATIONS =====
function triggerCelebration() {
  const container = document.getElementById('celebrationContainer');
  const colors = ['#FFD700', '#4CAF50', '#2196F3', '#9C27B0', '#FF9800'];
  
  // Create 30 particles
  for (let i = 0; i < 30; i++) {
    const particle = document.createElement('div');
    particle.className = 'celebration-particle';
    
    // Random properties
    const size = Math.random() * 15 + 5;
    const color = colors[Math.floor(Math.random() * colors.length)];
    const left = Math.random() * 100;
    const delay = Math.random() * 0.5;
    
    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;
    particle.style.backgroundColor = color;
    particle.style.left = `${left}%`;
    particle.style.animationDelay = `${delay}s`;
    
    container.appendChild(particle);
    
    // Remove after animation completes
    setTimeout(() => {
      particle.remove();
    }, 1500);
  }
  
  // Show container
  container.style.opacity = '1';
  
  // Hide after animation
  setTimeout(() => {
    container.style.opacity = '0';
  }, 1500);
}

function triggerMiniCelebration() {
  const container = document.getElementById('celebrationContainer');
  const colors = ['#FFD700', '#4CAF50'];
  
  // Create 10 smaller particles
  for (let i = 0; i < 10; i++) {
    const particle = document.createElement('div');
    particle.className = 'celebration-particle';
    
    // Random properties
    const size = Math.random() * 8 + 3;
    const color = colors[Math.floor(Math.random() * colors.length)];
    const left = 70 + Math.random() * 20;
    const delay = Math.random() * 0.3;
    
    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;
    particle.style.backgroundColor = color;
    particle.style.left = `${left}%`;
    particle.style.animationDelay = `${delay}s`;
    
    container.appendChild(particle);
    
    // Remove after animation completes
    setTimeout(() => {
      particle.remove();
    }, 1500);
  }
  
  // Show container
  container.style.opacity = '1';
  
  // Hide after animation
  setTimeout(() => {
    container.style.opacity = '0';
  }, 1500);
}

// ===== APPLY HOVER EFFECTS =====
function applyHoverEffects() {
  // Add ripple effect to all buttons
  const buttons = document.querySelectorAll('button');
  buttons.forEach(button => {
    button.addEventListener('click', function(e) {
      // Create ripple element
      const ripple = document.createElement('span');
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = e.clientX - rect.left - size / 2;
      const y = e.clientY - rect.top - size / 2;
      
      ripple.style.cssText = `
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.7);
        transform: scale(0);
        animation: ripple-animation 0.6s linear;
        width: ${size}px;
        height: ${size}px;
        top: ${y}px;
        left: ${x}px;
        pointer-events: none;
      `;
      
      this.appendChild(ripple);
      
      setTimeout(() => {
        ripple.remove();
      }, 600);
    });
  });
  
  // Add CSS for ripple animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes ripple-animation {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
  `;
  document.head.appendChild(style);
}

// ===== TYPING EFFECT FOR AI RESPONSES =====
function typeText(element, text, speed = 20) {
  return new Promise(resolve => {
    let i = 0;
    element.innerHTML = '';
    
    function typeChar() {
      if (i < text.length) {
        const char = text.charAt(i);
        element.innerHTML += char === "\n" ? "<br>" : char;
        i++;
        setTimeout(typeChar, speed);
      } else {
        resolve();
      }
    }
    
    typeChar();
  });
}

// ===== ENHANCED SEND QUESTION =====
async function sendQuestion(event) {
  // Prevent double-tap on mobile
  if (event && event.type === 'touchstart') {
    event.preventDefault();
  }
  
  const inputEl = document.getElementById("userInput");
  const question = inputEl.value.trim();
  if (!question) return;

  // Hide keyboard on mobile after sending
  if (isTouchDevice) {
    inputEl.blur();
  }

  const messagesDiv = document.getElementById("messages");

  // Add user message with animation
  const userMsg = document.createElement("div");
  userMsg.className = "user-message";
  userMsg.innerHTML = `You: ${question}`;
  userMsg.style.opacity = '0';
  userMsg.style.transform = 'translateY(20px)';
  messagesDiv.appendChild(userMsg);
  
  // Animate user message in
  setTimeout(() => {
    userMsg.style.opacity = '1';
    userMsg.style.transform = 'translateY(0)';
    userMsg.style.transition = 'opacity 0.3s, transform 0.3s';
  }, 10);
  
  inputEl.value = "";
  messagesDiv.scrollTop = messagesDiv.scrollHeight;

  // Add thinking animation
  const thinkingMsg = document.createElement("div");
  thinkingMsg.className = "ai-message";
  thinkingMsg.innerHTML = `<div class="typing-indicator">
    <span></span><span></span><span></span>
  </div>`;
  messagesDiv.appendChild(thinkingMsg);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;

  try {
    const response = await fetch("/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify({ history: [{ role: "user", content: question }] })
    });
    const data = await response.json();

    // Remove thinking message
    thinkingMsg.remove();

    const messageContent = data.choices?.[0]?.message?.content;
    const answerText = messageContent || "I apologize, but I couldn't generate a response at this moment. Please try again.";

    // Add AI message with typing effect
    const aiMsg = document.createElement("div");
    aiMsg.className = "ai-message typing-text";
    messagesDiv.appendChild(aiMsg);
    
    // Type out response
    await typeText(aiMsg, `Tawfiq AI: ${answerText}`, 15);
    
    // Remove typing cursor after completion
    aiMsg.classList.remove('typing-text');
    
    // Trigger mini celebration
    triggerMiniCelebration();

  } catch (error) {
    console.error("Error:", error);
    
    // Remove thinking message
    if (thinkingMsg.parentNode) {
      thinkingMsg.remove();
    }

    // Show error message
    const errorMsg = document.createElement("div");
    errorMsg.className = "ai-message";
    errorMsg.textContent = "Tawfiq AI: I apologize for the error. Please try again or check your connection.";
    messagesDiv.appendChild(errorMsg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }
}

// ===== ENHANCED TAB SWITCHING =====
function switchTab(sectionId, event) {
  // Prevent default for touch events
  if (event && event.preventDefault) event.preventDefault();
  
  // Remove active class from all tabs and sections
  document.querySelectorAll('.section').forEach(s => {
    s.classList.remove('active');
    s.style.opacity = '0';
    s.style.transform = 'translateY(20px)';
  });
  
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));
  
  // Add active class to clicked tab
  if (event && event.target.classList.contains('tab')) {
    event.target.classList.add('active');
  }
  
  // Update bottom nav
  const tabIndex = Array.from(document.querySelectorAll('.tab')).findIndex(tab => 
    tab.onclick && tab.onclick.toString().includes(sectionId)
  );
  if (tabIndex > -1) {
    document.querySelectorAll('.bottom-nav-item')[tabIndex].classList.add('active');
  }
  
  // Show selected section with animation
  const activeSection = document.getElementById(sectionId);
  activeSection.classList.add('active');
  
  setTimeout(() => {
    activeSection.style.opacity = '1';
    activeSection.style.transform = 'translateY(0)';
    activeSection.style.transition = 'opacity 0.5s, transform 0.5s';
    // Scroll to top of section on mobile
    if (isTouchDevice) {
      activeSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, 10);
  
  // Load specific content for tab
  if (sectionId === 'prayerTimes') loadPrayerTimes();
  if (sectionId === 'duaSection') loadDailyDua();
  
  // Trigger mini celebration on tab switch
  triggerMiniCelebration();
}

// ===== ORIGINAL FUNCTIONS =====
let chatHistory = [];
let audioPlayer = null;

// WebRTC Variables
let socket;
let localStream;
let peers = {};
let isVideoEnabled = true;
let isAudioEnabled = true;
let ROOM_ID = null;

function loadDailyDua() {
// Try to fetch from the server first
fetch('/daily-dua')
  .then(res => {
    if (!res.ok) throw new Error('Network response was not ok');
    return res.json();
  })
  .then(data => {
    if (data.dua) {
      const dua = data.dua;
      const duaHTML = `
        <div class="dua-arabic" style="font-family: 'Amiri', serif; font-size: 1.5em; text-align: right; margin-bottom: 15px; color: #00695c;">
          ${dua.arabic}
        </div>
        <div class="dua-english" style="font-size: 1.1em; margin-bottom: 10px; line-height: 1.6;">
          ${dua.english}
        </div>
        <div class="dua-reference" style="font-size: 0.9em; color: #666; font-style: italic;">
          Reference: ${dua.reference} | Category: ${dua.category}
        </div>
      `;
      document.getElementById('dailyDuaContent').innerHTML = duaHTML;
    } else {
      // Fallback to local hardcoded Duas
      loadHardcodedDua();
    }
  })
  .catch(error => {
    console.log('Fetching from server failed, using hardcoded Duas');
    loadHardcodedDua();
  });
}

function loadHardcodedDua() {
const hardcodedDuas = [
  {
    arabic: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ¢ÿ™ŸêŸÜŸéÿß ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÅŸêŸä ÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÇŸêŸÜŸéÿß ÿπŸéÿ∞Ÿéÿßÿ®Ÿé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê",
    english: "Our Lord, give us in this world [that which is] good and in the Hereafter [that which is] good and protect us from the punishment of the Fire.",
    reference: "Quran 2:201",
    category: "General"
  },
  {
    arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿπŸêŸÑŸíŸÖŸãÿß ŸÜŸéÿßŸÅŸêÿπŸãÿßÿå ŸàŸéÿ±Ÿêÿ≤ŸíŸÇŸãÿß ÿ∑ŸéŸäŸêŸëÿ®Ÿãÿßÿå ŸàŸéÿπŸéŸÖŸéŸÑÿßŸã ŸÖŸèÿ™ŸéŸÇŸéÿ®ŸéŸëŸÑÿßŸã",
    english: "O Allah, I ask You for beneficial knowledge, goodly provision, and acceptable deeds.",
    reference: "Sunan Ibn Majah",
    category: "Knowledge"
  },
  {
    arabic: "ÿ±Ÿéÿ®ŸêŸë ÿßÿ¥Ÿíÿ±Ÿéÿ≠Ÿí ŸÑŸêŸä ÿµŸéÿØŸíÿ±ŸêŸä ŸàŸéŸäŸéÿ≥ŸêŸëÿ±Ÿí ŸÑŸêŸä ÿ£ŸéŸÖŸíÿ±ŸêŸä",
    english: "My Lord, expand for me my breast [with assurance] and ease for me my task.",
    reference: "Quran 20:25-26",
    category: "Ease"
  }
];

// Get a different Dua each day
const today = new Date();
const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
const duaIndex = dayOfYear % hardcodedDuas.length;
const dua = hardcodedDuas[duaIndex];

const duaHTML = `
  <div class="dua-arabic" style="font-family: 'Amiri', serif; font-size: 1.5em; text-align: right; margin-bottom: 15px; color: #00695c;">
    ${dua.arabic}
  </div>
  <div class="dua-english" style="font-size: 1.1em; margin-bottom: 10px; line-height: 1.6;">
    ${dua.english}
  </div>
  <div class="dua-reference" style="font-size: 0.9em; color: #666; font-style: italic;">
    Reference: ${dua.reference} | Category: ${dua.category}
  </div>
`;

document.getElementById('dailyDuaContent').innerHTML = duaHTML;
}

function loadPrayerTimes() {
  fetch('/get-prayer-times')
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById('prayerTimesContent');
      if (data && data.prayer_times) {
        container.innerHTML = '';
        for (const [name, time] of Object.entries(data.prayer_times)) {
          const p = document.createElement('p');
          p.innerHTML = `<strong>${name}:</strong> ${time}`;
          container.appendChild(p);
        }
      } else {
        container.innerHTML = '<p>Prayer times data unavailable.</p>';
      }
    })
    .catch(error => {
      console.error('Error fetching prayer times:', error);
      document.getElementById('prayerTimesContent').innerHTML = '<p>Error loading prayer times.</p>';
    });
}

function loadSurahList() {
  fetch('/get-surah-list')
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById('surahList');
      select.innerHTML = '<option value="">-- Or Select Surah --</option>';
      
      if (data && data.surah_list && Array.isArray(data.surah_list)) {
        data.surah_list.forEach((surahName, index) => {
          const option = document.createElement('option');
          option.value = index + 1;
          option.textContent = `${index + 1}. ${surahName}`;
          select.appendChild(option);
        });
      } else {
        loadHardcodedSurahList();
      }
    })
    .catch(error => {
      console.error('Error loading Surah list:', error);
      loadHardcodedSurahList();
    });
}

function loadHardcodedSurahList() {
  const surahs = [
    "Al-Fatihah", "Al-Baqarah", "Aali Imran", "An-Nisa", "Al-Maidah", "Al-Anam", "Al-Araf",
    "Al-Anfal", "At-Tawbah", "Yunus", "Hud", "Yusuf", "Ar-Rad", "Ibrahim", "Al-Hijr",
    "An-Nahl", "Al-Isra", "Al-Kahf", "Maryam", "Ta-Ha", "Al-Anbiya", "Al-Hajj", "Al-Muminun",
    "An-Nur", "Al-Furqan", "Ash-Shuara", "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum",
    "Luqman", "As-Sajda", "Al-Ahzab", "Saba", "Fatir", "Ya-Sin", "As-Saffat", "Sad",
    "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiya",
    "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur",
    "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'a", "Al-Hadid", "Al-Mujadila", "Al-Hashr",
    "Al-Mumtahanah", "As-Saff", "Al-Jumu'a", "Al-Munafiqun", "At-Taghabun", "At-Talaq",
    "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn",
    "Al-Muzzammil", "Al-Muddathir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba",
    "An-Nazi'at", "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq",
    "Al-Buruj", "At-Tariq", "Al-Ala", "Al-Ghashiyah", "Al-Fajr", "Al-Balad", "Ash-Shams",
    "Al-Lail", "Ad-Duha", "Ash-Sharh", "At-Tin", "Al-Alaq", "Al-Qadr", "Al-Bayyina",
    "Az-Zalzalah", "Al-Adiyat", "Al-Qari'a", "At-Takathur", "Al-Asr", "Al-Humazah",
    "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", "Al-Kafirun", "An-Nasr", "Al-Masad",
    "Al-Ikhlas", "Al-Falaq", "An-Nas"
  ];
  const select = document.getElementById('surahList');
  surahs.forEach(surah => {
    const option = document.createElement('option');
    option.value = surah;
    option.textContent = surah;
    select.appendChild(option);
  });
}

function loadHadithTopics() {
  const topics = [
    "Hadith on Prayer", "Hadith on Faith", "Hadith on Charity", "Hadith on Patience",
    "Hadith on Gratitude", "Hadith on Kindness", "Hadith on Fasting", "Hadith on Hajj",
    "Hadith on Honesty", "Hadith on Forgiveness", "Hadith on Parents", "Hadith on Children",
    "Hadith on Marriage", "Hadith on Neighbors", "Hadith on Brotherhood", "Hadith on Modesty",
    "Hadith on Repenance", "Hadith on Mercy", "Hadith on Humility", "Hadith on Envy",
    "Hadith on Justice", "Hadith on Knowledge", "Hadith on Dua", "Hadith on Quran",
    "Hadith on Sunnah", "Hadith on Hellfire", "Hadith on Paradise", "Hadith on Backbiting",
    "Hadith on Lying", "Hadith on Trust", "Hadith on Trade", "Hadith on Wealth",
    "Hadith on Poverty", "Hadith on Oppression", "Hadith on Manners", "Hadith on Sincerity",
    "Hadith on Innovation", "Hadith on Angels", "Hadith on Jinn", "Hadith on Death",
    "Hadith on Resurrection", "Hadith on Signs of Day of Judgment", "Hadith on Health",
    "Hadith on Cleanliness", "Hadith on Generosity", "Hadith on Bribery", "Hadith on Gossip",
    "Hadith on Leadership", "Hadith on Love", "Hadith on Peace", "Hadith on Prayer at Night",
    "Hadith on Ablution", "Hadith on Sadaqah", "Hadith on Zakat", "Hadith on Seeking Knowledge",
    "Hadith on Good Deeds", "Hadith on Evil Deeds", "Hadith on Hypocrisy", "Hadith on Arrogance",
    "Hadith on Tawheed", "Hadith on Shirk", "Hadith on Respecting Elders", "Hadith on Youth",
    "Hadith on Orphans", "Hadith on Widows", "Hadith on Modesty in Dressing",
    "Hadith on Halal and Haram", "Hadith on Gossip", "Hadith on Anger", "Hadith on Smiling",
    "Hadith on Good Speech", "Hadith on Contentment", "Hadith on Worldly Life",
    "Hadith on Akhirah", "Hadith on Thankfulness", "Hadith on Seeking Forgiveness",
    "Hadith on Trials", "Hadith on Signs of Hypocrites", "Hadith on Visiting Graves",
    "Hadith on Trust in Allah", "Hadith on Destiny", "Hadith on Martyrdom", "Hadith on Courage",
    "Hadith on Sin", "Hadith on Purification", "Hadith on Eid", "Hadith on Sacrifice",
    "Hadith on Brotherhood in Islam", "Hadith on Leadership in Islam", "Hadith on Reciting Quran",
    "Hadith on Betrayal", "Hadith on Contentment", "Hadith on Piety", "Hadith on Remembrance of Allah",
    "Hadith on Friday Prayer", "Hadith on Allah's Mercy", "Hadith on Night of Qadr",
    "Hadith on Family Ties"
  ];
  const dropdown = document.getElementById('hadithDropdown');
  topics.forEach(topic => {
    const option = document.createElement('option');
    option.value = topic;
    option.textContent = topic;
    dropdown.appendChild(option);
  });
}

function initializeAudioPlayer() {
  audioPlayer = document.getElementById('surahAudio');
  if (!audioPlayer) return;
  
  audioPlayer.addEventListener('timeupdate', updateProgress);
  audioPlayer.addEventListener('loadedmetadata', function() {
    updateTimeDisplay();
  });
  audioPlayer.addEventListener('ended', function() {
    document.getElementById('playPauseBtn').classList.remove('playing');
    document.getElementById('playPauseBtn').textContent = 'Play';
  });
}

function togglePlayPause() {
  const btn = document.getElementById('playPauseBtn');
  if (audioPlayer.paused) {
    audioPlayer.play();
    btn.classList.add('playing');
    btn.textContent = 'Pause';
  } else {
    audioPlayer.pause();
    btn.classList.remove('playing');
    btn.textContent = 'Play';
  }
}

function updateProgress() {
  const progressBar = document.getElementById('progressBar');
  const value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
  progressBar.style.width = value + '%';
  updateTimeDisplay();
}

function updateTimeDisplay() {
  const timeDisplay = document.getElementById('timeDisplay');
  const currentTime = formatTime(audioPlayer.currentTime);
  const duration = formatTime(audioPlayer.duration);
  timeDisplay.textContent = `${currentTime} / ${duration}`;
}

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
}

const surahNameToNumber = {
  "Al-Fatihah": 1, "Al-Baqarah": 2, "Aali Imran": 3, "An-Nisa": 4, "Al-Ma'idah": 5,
  "Al-An'am": 6, "Al-A'raf": 7, "Al-Anfal": 8, "At-Tawbah": 9, "Yunus": 10,
  "Hud": 11, "Yusuf": 12, "Ar-Ra'd": 13, "Ibrahim": 14, "Al-Hijr": 15,
  "An-Nahl": 16, "Al-Isra": 17, "Al-Kahf": 18, "Maryam": 19, "Ta-Ha": 20,
  "Al-Anbiya": 21, "Al-Hajj": 22, "Al-Mu'minun": 23, "An-Nur": 24, "Al-Furqan": 25,
  "Ash-Shu'ara": 26, "An-Naml": 27, "Al-Qasas": 28, "Al-Ankabut": 29, "Ar-Rum": 30,
  "Luqman": 31, "As-Sajda": 32, "Al-Ahzab": 33, "Saba": 34, "Fatir": 35,
  "Ya-Sin": 36, "As-Saffat": 37, "Sad": 38, "Az-Zumar": 39, "Ghafir": 40,
  "Fussilat": 41, "Ash-Shura": 42, "Az-Zukhruf": 43, "Ad-Dukhan": 44, "Al-Jathiya": 45,
  "Al-Ahqaf": 46, "Muhammad": 47, "Al-Fath": 48, "Al-Hujurat": 49, "Qaf": 50,
  "Adh-Dhariyat": 51, "At-Tur": 52, "An-Najm": 53, "Al-Qamar": 54, "Ar-Rahman": 55,
  "Al-Waqi'a": 56, "Al-Hadid": 57, "Al-Mujadila": 58, "Al-Hashr": 59, "Al-Mumtahina": 60,
  "As-Saff": 61, "Al-Jumu'a": 62, "Al-Munafiqun": 63, "At-Taghabun": 64, "At-Talaq": 65,
  "At-Tahrim": 66, "Al-Mulk": 67, "Al-Qalam": 68, "Al-Haqqa": 69, "Al-Ma'arij": 70,
  "Nuh": 71, "Al-Jinn": 72, "Al-Muzzammil": 73, "Al-Muddathir": 74, "Al-Qiyama": 75,
  "Al-Insan": 76, "Al-Mursalat": 77, "An-Naba": 78, "An-Nazi'at": 79, "Abasa": 80,
  "At-Takwir": 81, "Al-Infitar": 82, "Al-Mutaffifin": 83, "Al-Inshiqaq": 84, "Al-Buruj": 85,
  "At-Tariq": 86, "Al-A'la": 87, "Al-Ghashiya": 88, "Al-Fajr": 89, "Al-Balad": 90,
  "Ash-Shams": 91, "Al-Lail": 92, "Ad-Duha": 93, "Ash-Sharh": 94, "At-Tin": 95,
  "Al-'Alaq": 96, "Al-Qadr": 97, "Al-Bayyina": 98, "Az-Zalzala": 99, "Al-Adiyat": 100,
  "Al-Qari'a": 101, "At-Takathur": 102, "Al-Asr": 103, "Al-Humaza": 104, "Al-Fil": 105,
  "Quraysh": 106, "Al-Ma'un": 107, "Al-Kawthar": 108, "Al-Kafirun": 109, "An-Nasr": 110,
  "Al-Masad": 111, "Al-Ikhlas": 112, "Al-Falaq": 113, "An-Nas": 114
};

function playSurah() {
  const query = document.getElementById("quranInput").value.trim();
  const selectedSurah = document.getElementById("surahList").value;
  const surahName = query || selectedSurah;
  
  if (!surahName || !surahNameToNumber[surahName]) {
    alert("Please select a valid Surah from the list.");
    return;
  }

  const surahNumber = surahNameToNumber[surahName];
  const audioPlayerContainer = document.getElementById('audioPlayer');
  const audioElement = document.getElementById('surahAudio');
  
  audioPlayerContainer.style.display = 'block';
  
  audioElement.src = `https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/${surahNumber}.mp3`;
  
  document.getElementById('playPauseBtn').textContent = 'Loading...';
  document.getElementById('playPauseBtn').disabled = true;
  
  audioElement.oncanplay = function() {
    document.getElementById('playPauseBtn').textContent = 'Play';
    document.getElementById('playPauseBtn').disabled = false;
    document.getElementById('timeDisplay').textContent = '0:00 / ' + formatTime(audioElement.duration);
  };
  
  audioElement.onerror = function() {
    alert("Could not load audio for this Surah. Please try another one.");
    document.getElementById('playPauseBtn').textContent = 'Play';
    document.getElementById('playPauseBtn').disabled = false;
  };
}

function searchQuran() {
  const query = document.getElementById("quranInput").value.trim();
  const selectedSurah = document.getElementById("surahList").value;
  const surahName = query || selectedSurah;
  const resultDiv = document.getElementById("quranResult");
  const quranSearchBtn = document.getElementById("quranSearchButton");

  if (!surahName || !surahNameToNumber[surahName]) {
    resultDiv.innerHTML = `<div class="user-message">Please select a valid Surah from the list.</div>`;
    return;
  }

  const surahNumber = surahNameToNumber[surahName];

  resultDiv.innerHTML = `<div class="user-message">Searching Surah: ${surahName}</div>`;
  
  const loading = document.createElement("div");
  loading.className = "loading-indicator";
  loading.textContent = "Searching Quran...";
  resultDiv.appendChild(loading);
  quranSearchBtn.disabled = true;

  fetch('/quran-surah', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ surah_number: surahNumber })
  })
  .then(res => res.json())
  .then(data => {
    resultDiv.innerHTML = '';

    if (data.surah_name) {
      const titleEl = document.createElement("div");
      titleEl.innerHTML = `<strong>Surah ${surahNumber}: ${data.surah_name}</strong>`;
      titleEl.style.fontSize = '18px';
      titleEl.style.marginBottom = '10px';
      resultDiv.appendChild(titleEl);
    }

    if (data.ayahs && Array.isArray(data.ayahs) && data.ayahs.length > 0) {
      data.ayahs.forEach(verse => {
        const verseEl = document.createElement("div");
        verseEl.className = "verse-block";
        verseEl.style.marginBottom = '20px';

        const info = document.createElement("p");
        info.innerHTML = `<strong>Ayah ${verse.ayah_number}</strong>`;
        verseEl.appendChild(info);

        const arabic = document.createElement("p");
        arabic.textContent = verse.arabic;
        arabic.style.textAlign = 'right';
        arabic.style.fontWeight = 'bold';
        arabic.style.direction = 'rtl';
        verseEl.appendChild(arabic);

        const trans = document.createElement("p");
        trans.textContent = verse.english;
        verseEl.appendChild(trans);

        if (verse.transliteration) {
          const translitPara = document.createElement("p");
          translitPara.innerHTML = `<em>Transliteration:</em> ${verse.transliteration}`;
          translitPara.style.fontSize = '0.9em';
          verseEl.appendChild(translitPara);
        }

        resultDiv.appendChild(verseEl);
      });
    } else {
      resultDiv.innerHTML = `<div>No verses found for Surah ${surahName}.</div>`;
    }
  })
  .catch(error => {
    console.error('Error:', error);
    resultDiv.innerHTML = `<div>Error searching Quran. Please try again.</div>`;
  })
  .finally(() => {
    const loadingEl = resultDiv.querySelector('.loading-indicator');
    if (loadingEl) loadingEl.remove();
    quranSearchBtn.disabled = false;
  });
}

function searchHadith() {
  const inputQuery = document.getElementById("hadithInput").value.trim();
  const dropdownQuery = document.getElementById("hadithDropdown").value;
  const query = inputQuery || dropdownQuery;
  if (!query) return;
  const resultDiv = document.getElementById("hadithResult");
  const hadithBtn = document.getElementById("hadithSearchButton");
  resultDiv.innerHTML = `<div class="user-message">Searching: ${query}</div>`;
  const loading = document.createElement("div");
  loading.className = "loading-indicator";
  loading.textContent = "Searching Hadith...";
  resultDiv.appendChild(loading);
  hadithBtn.disabled = true;

  fetch('/hadith-search', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ query })
  }).then(res => res.json()).then(data => {
    resultDiv.innerHTML = `<div class="user-message">Searching: ${query}</div>`;
    if (data.results && Array.isArray(data.results) && data.results.length > 0) {
      data.results.forEach(hadith => {
        const hadithEl = document.createElement("div");
        hadithEl.className = "hadith-entry";

        let infoText = '';
        if (hadith.book_name && hadith.book_number && hadith.book_name !== 'Unknown Book' && hadith.book_number !== 'N/A') {
          infoText += `<strong>Book:</strong> ${hadith.book_name} (${hadith.book_number})`;
        } else if (hadith.book_name && hadith.book_name !== 'Unknown Book') {
          infoText += `<strong>Book:</strong> ${hadith.book_name}`;
        } else if (hadith.book_number && hadith.book_number !== 'N/A') {
          infoText += `<strong>Book Number:</strong> ${hadith.book_number}`;
        }
        if (hadith.volume_number && hadith.volume_number !== 'N/A') {
          infoText += (infoText ? '<br>' : '') + `<strong>Volume:</strong> ${hadith.volume_number}`;
        }
        if (hadith.hadith_info && hadith.hadith_info !== 'Volume N/A, Book N/A') {
          if (!infoText.includes(hadith.hadith_info))
            infoText += (infoText ? '<br>' : '') + `<strong>Info:</strong> ${hadith.hadith_info}`;
        }
        if (hadith.narrator && hadith.narrator !== 'Unknown narrator') {
          infoText += (infoText ? '<br>' : '') + `<strong>Narrated by:</strong> ${hadith.narrator}`;
        }

        const infoPara = document.createElement("p");
        infoPara.innerHTML = infoText;
        hadithEl.appendChild(infoPara);

        const textPara = document.createElement("p");
        textPara.textContent = hadith.text;
        textPara.style.marginTop = '8px';
        hadithEl.appendChild(textPara);

        resultDiv.appendChild(hadithEl);
      });
    } else if (data.result) {
      resultDiv.innerHTML += `<div>${data.result}</div>`;
    } else {
      resultDiv.innerHTML += `<div>No result found for "${query}".</div>`;
    }
  }).catch(error => {
    console.error('Error:', error);
    resultDiv.innerHTML += `<div>Error searching Hadith.</div>`;
  }).finally(() => {
    document.getElementById("hadithSearchButton").disabled = false;
  });
}
</script>
</body>
</html>
